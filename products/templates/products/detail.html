{% extends 'base.html' %}
{% load custom_tags %}
{% load static %}
{% block links %}
  <link rel="stylesheet" href="{% static 'products/detail.css' %}">
{% endblock %}
{% block content %}
  <div class='preview-container' id="{{ product.id }}">
    <img class='product-on-view' src='{{ product.image.url }}'>
    <h1>{{ product.name }}</h1>
  </div>
  <form>
    {{ form.rating|add_class:'rating' }}
    {{ form.feedback|add_class:'feedback' }}
  </form>
  <button id="submit-review">submit</button>
{% endblock %}
{% block scripts %}
  <script>
  $(document).ready(function(){
    $('#submit-review').click(function(){
      let rating = $('.rating').val()
      let feedback = $('.feedback').val()
      let id = $('.preview-container').attr('id')

      if($(rating)&&$(feedback)){
        $.ajax({
        url: '{% url "add-review" %}',
        method:'POST',
        headers:{
          'X-CSRFToken':'{{ csrf_token }}'
        },
        data:JSON.stringify({
          rating:rating,
          feedback:feedback,
          id:id
        }),
        success:function(response){
          alert(response.message)
        },
        error:function(){
          alert('error')
        }
      });
      }
    });
  });
  </script>
{% endblock %}